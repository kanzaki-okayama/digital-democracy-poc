<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ãƒ‡ã‚¸ã‚¿ãƒ«æ°‘ä¸»ä¸»ç¾©PoC</title>

  <!-- Leaflet & CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="css/style.css" />
  <link rel="icon" href="https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png" />

  <style>
    /* === ğŸ§­ ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ === */
    header.navbar {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 56px;
      background-color: #2c3e50;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 20px;
      z-index: 3000;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .navbar-title {
      font-weight: bold;
      font-size: 18px;
    }

    nav.navbar-menu {
      display: flex;
      gap: 16px;
    }

    .nav-link {
      color: #fff;
      background: none;
      border: none;
      font-size: 15px;
      cursor: pointer;
      transition: color 0.2s;
    }

    .nav-link:hover {
      color: #f1c40f;
    }

    /* === ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ === */
    main#content {
      position: absolute;
      top: 56px;
      left: 0;
      right: 0;
      bottom: 0;
      overflow: hidden;
    }

    .page {
      display: none;
      width: 100%;
      height: 100%;
    }

    .page.active {
      display: block;
    }

    /* === Leafletãƒãƒƒãƒ— === */
    #map {
      width: 100%;
      height: 100%;
    }

    /* --- æŠ•ç¨¿ãƒœã‚¿ãƒ³ --- */
    #postBtn {
      position: fixed;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%);
      background-color: #007bff;
      color: #fff;
      font-size: 16px;
      font-weight: bold;
      border: none;
      border-radius: 28px;
      padding: 12px 32px;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0,0,0,0.25);
      transition: background-color 0.2s, transform 0.2s;
      z-index: 5000; /* â† Leafletã®ä¸Šã«ãã‚‹ã‚ˆã†å¼·åŒ– */
    }

    #postBtn:hover {
      background-color: #0056b3;
      transform: translateX(-50%) scale(1.05);
    }

    /* === ğŸ“±ã‚¹ãƒãƒ›å¯¾å¿œ === */
    @media (max-width: 768px) {
      /* ã‚¿ã‚¤ãƒˆãƒ«ä¸­å¤®å¯„ã› */
      .navbar-title {
        margin: 0 auto;
        font-size: 16px;
      }

      /* ãƒ¡ãƒ‹ãƒ¥ãƒ¼éè¡¨ç¤ºï¼ˆãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼é–‹é–‰æ™‚ã«å‡ºã™ï¼‰ */
      nav.navbar-menu {
        display: none;
        flex-direction: column;
        position: fixed;
        top: 56px;
        right: 0;
        background: #2c3e50;
        width: 60%;
        height: calc(100vh - 56px);
        padding: 16px;
        box-shadow: -2px 0 6px rgba(0,0,0,0.3);
        z-index: 3500;
      }

      nav.navbar-menu.open {
        display: flex;
      }

      .nav-link {
        color: #fff;
        font-size: 15px;
        text-align: left;
        padding: 10px 0;
        border-bottom: 1px solid rgba(255,255,255,0.1);
      }

      /* ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒœã‚¿ãƒ³ */
      .hamburger {
        display: flex;
        flex-direction: column;
        justify-content: space-around;
        width: 26px;
        height: 20px;
        cursor: pointer;
      }
      .hamburger span {
        height: 3px;
        background: #fff;
        border-radius: 2px;
        transition: all 0.3s ease;
      }
      .hamburger.active span:nth-child(1) {
        transform: translateY(8px) rotate(45deg);
      }
      .hamburger.active span:nth-child(2) {
        opacity: 0;
      }
      .hamburger.active span:nth-child(3) {
        transform: translateY(-8px) rotate(-45deg);
      }


      #postBtn {
        font-size: 14px;
        padding: 10px 24px;
        bottom: 16px;
      }
    }
  </style>
</head>

<body>
  <!-- ğŸ§­ ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ -->
  <header class="navbar">
    <div class="navbar-title">ãƒ‡ã‚¸ã‚¿ãƒ«æ°‘ä¸»ä¸»ç¾©PoC</div>
    <!-- ğŸ” ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
    <div class="hamburger" id="hamburger">
      <span></span><span></span><span></span>
    </div>
    <nav class="navbar-menu" id="navbarMenu">
      <button class="nav-link" data-page="map">æ„è¦‹æŠ•ç¨¿ãƒãƒƒãƒ—</button>
      <button class="nav-link" data-page="relation">é–¢ä¿‚æ€§ãƒãƒƒãƒ—</button>
      <button class="nav-link" data-page="ideas">èª²é¡Œè§£æ±ºã‚¢ã‚¤ãƒ‡ã‚¢</button>
      <button class="nav-link" data-page="about">ã“ã®ã‚µã‚¤ãƒˆã«ã¤ã„ã¦</button>
    </nav>
  </header>

  <!-- ğŸ§© ã‚³ãƒ³ãƒ†ãƒ³ãƒ„é ˜åŸŸ -->
  <main id="content">
    <div id="mapPage" class="page active">
      <!-- âœ… Leafletã‚ˆã‚Šä¸Šã«ãƒœã‚¿ãƒ³é…ç½® -->
      <div id="map"></div>

      <!-- ğŸ“‹ æ„è¦‹ä¸€è¦§ï¼ˆé–‹é–‰å¼ï¼‰ -->
      <aside id="sidebar">
        <div class="sidebar-header">
          <span>æ„è¦‹ä¸€è¦§</span>
          <button id="closeSidebarBtn">âœ•</button>
        </div>
        <div id="sidebarContent"></div>
      </aside>

      <!-- â• æŠ•ç¨¿ãƒœã‚¿ãƒ³ -->
      <button id="postBtn">ï¼‹ æ–°ã—ã„æ„è¦‹ã‚’æŠ•ç¨¿</button>
    </div>
  </main>

  <!-- ğŸ’¬ æŠ•ç¨¿ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div id="postModal" class="modal" hidden>
    <div class="modal-inner">
      <h3>æ–°ã—ã„æ„è¦‹ã‚’æŠ•ç¨¿</h3>
      <div id="regionDisplay" style="font-size:13px; color:#555; margin-bottom:8px;"></div>
      <label>ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ </label>
      <input id="displayName" maxlength="50" placeholder="ä¾‹ï¼šå²¡å±±å¸‚æ°‘A" />
      <label>å†…å®¹</label>
      <textarea id="postContent" rows="4" maxlength="2000" placeholder="ã“ã®å ´æ‰€ã«ã¤ã„ã¦ã®ã”æ„è¦‹â€¦"></textarea>
      <div class="actions">
        <button id="cancelBtn">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button id="submitBtn">æŠ•ç¨¿ã™ã‚‹</button>
      </div>
    </div>
  </div>

<!-- ğŸ’¬ æŠ•ç¨¿è©³ç´°ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
<div id="postOverlay" class="overlay" hidden>
  <div class="overlay-inner">
    <button id="closeOverlayBtn" class="overlay-close">âœ•</button>
    <div id="overlayContent" class="overlay-content"></div>
  </div>
</div>


  <!-- âœ… å¿…ãš Leaflet ã‚’ main.js ã‚ˆã‚Šå…ˆã«èª­ã¿è¾¼ã‚€ -->
  <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>

  <!-- ğŸ‘‡ ã“ã‚Œã‚’æœ€å¾Œã« -->
  <script type="module" src="js/main.js"></script>

  <!-- ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ -->
  <div id="toast" class="toast"></div>

  <!-- ğŸ“± UIåˆ¶å¾¡ã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const sidebar = document.getElementById("sidebar");
      const postBtn = document.getElementById("postBtn");
      const closeSidebarBtn = document.getElementById("closeSidebarBtn");
      const hamburger = document.getElementById("hamburger");
      const navbarMenu = document.getElementById("navbarMenu");
      const navLinks = document.querySelectorAll(".nav-link");

      // ğŸ” ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼é–‹é–‰
      if (hamburger && navbarMenu) {
        hamburger.addEventListener("click", () => {
          hamburger.classList.toggle("active");
          navbarMenu.classList.toggle("open");
        });
      }

      // ğŸ§­ ãƒšãƒ¼ã‚¸åˆ‡æ›¿æ™‚ã¯ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‰ã˜ã‚‹
      navLinks.forEach(link => {
        link.addEventListener("click", () => {
          hamburger.classList.remove("active");
          navbarMenu.classList.remove("open");
        });
      });
    });
  </script>
 <!-- ğŸ“± ã‚¹ãƒ¯ã‚¤ãƒ—ã§æ„è¦‹ä¸€è¦§ã‚’é–‹é–‰ï¼ˆã‚¿ãƒƒãƒãƒ‘ãƒãƒ«å¯¾å¿œï¼‰ -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const sidebar = document.getElementById("sidebar");
      if (!sidebar) return;

      let startY = 0;
      let currentY = 0;
      let isDragging = false;

      // --- Pointerç³»ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä½¿ç”¨ï¼ˆãƒã‚¦ã‚¹ï¼‹ã‚¿ãƒƒãƒï¼‹ãƒšãƒ³ã™ã¹ã¦å¯¾å¿œï¼‰
      const startHandler = (e) => {
        isDragging = true;
        startY = e.clientY ?? e.touches?.[0]?.clientY;
      };

      const moveHandler = (e) => {
        if (!isDragging) return;
        currentY = e.clientY ?? e.touches?.[0]?.clientY;
      };

      const endHandler = () => {
        if (!isDragging) return;
        const diffY = currentY - startY;

        // ä¸‹ã‚¹ãƒ¯ã‚¤ãƒ— â†’ é–‰ã˜ã‚‹
        if (diffY > 80 && sidebar.classList.contains("show")) {
          sidebar.classList.remove("show");
        }
        // ä¸Šã‚¹ãƒ¯ã‚¤ãƒ—ï¼ˆç”»é¢ä¸‹1/4ã‹ã‚‰ï¼‰â†’ é–‹ã
        else if (diffY < -80 && !sidebar.classList.contains("show")) {
          const triggerZone = window.innerHeight * 0.75;
          if (startY > triggerZone) {
            sidebar.classList.add("show");
          }
        }

        isDragging = false;
        startY = 0;
        currentY = 0;
      };

      // --- ã‚¤ãƒ™ãƒ³ãƒˆç™»éŒ²ï¼ˆpointerã‚¤ãƒ™ãƒ³ãƒˆå„ªå…ˆï¼‰
      document.addEventListener("pointerdown", startHandler);
      document.addEventListener("pointermove", moveHandler);
      document.addEventListener("pointerup", endHandler);

      // --- å¤ã„ãƒ–ãƒ©ã‚¦ã‚¶ç”¨fallbackï¼ˆtouchã‚¤ãƒ™ãƒ³ãƒˆï¼‰
      document.addEventListener("touchstart", startHandler);
      document.addEventListener("touchmove", moveHandler);
      document.addEventListener("touchend", endHandler);
    });
  </script>
</body>
</html>

